<p id="notice"><%= notice %></p>

<h1>Users</h1>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Password</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @users.each do |user| %>
      <tr>
        <td><%= user.name %></td>
        <td><%= user.password %></td>
        <td><%= link_to 'Show', user %></td>
        <td><%= link_to 'Edit', edit_user_path(user) %></td>
        <td><%= link_to 'Destroy', user, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>


<button id="speech_btn">SPEECH</button>
<button id="synthesis">Synthesis</button>

<div id="speech_out">
  <p id="synth_test1">Here is a test.</p>

</div>

<div>
  <label>Name:</label>
  <input type="text" id="username">
</div>
<br>
<div>
  <textarea id="msg_text" cols="30" rows="3"></textarea>
  <button id="send">送信</button>
</div>
<hr>
<div id="output"></div>



<script>
var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition

var speech = new SpeechRecognition();
speech.lang = "ja-JP";

document.querySelector("#speech_btn").addEventListener("click", function(e){
  speech.start();
});

speech.onresult = function(e){
  speech.stop();
  console.log(e.results);

  document.querySelector("#speech_out").innerHTML += "<p>You speak: " + e.results[0][0].transcript + "</p>";

};

speech.onend = () => {
  console.log("Speech Recognition is end.");
  speech.start();
}

var synth = window.speechSynthesis;
var btn = document.querySelector("#synthesis");
var text = document.querySelector("#synth_test1").textContent;

btn.onclick = function(e) {
  var utter = new SpeechSynthesisUtterance(text);
  utter.lang = 'en-US';
  utter.voice = synth.getVoices()[1];
  synth.speak(utter);
}

</script>

    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.3.3/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-auth.js"></script>  
    <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-database.js"></script>

    <script>
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var firebaseConfig = {
        apiKey: "AIzaSyCrBDPXwTKsgiHbLbUsjxq3oSWrCkWvmtw",
        authDomain: "chatapp-1cc84.firebaseapp.com",
        databaseURL: "https://chatapp-1cc84-default-rtdb.firebaseio.com/",
        projectId: "chatapp-1cc84",
        storageBucket: "chatapp-1cc84.appspot.com",
        messagingSenderId: "302666486109",
        appId: "1:302666486109:web:58cbc9d7f6c942a440d8b4",
        measurementId: "G-NRLG6VXKYJ"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();


    </script>

    <script>
    var newPostRef = firebase.database();
    let room = "room2"

    const send = document.getElementById("send");
    const username = document.getElementById("username");
    const a_text = document.getElementById("msg_text");
    const output = document.getElementById("output");

    send.addEventListener('click', function(){
        newPostRef.ref(room).push({
            username: username.value,
            a_text: a_text.value
        });
        a_text.value = "";
    });

    newPostRef.ref(room).on("child_added", function(data){
        const v = data.val();
        const k = data.key;
        let str = "";

        str += '<div class="name">' + v.username + '</div>';
        str += '<div class="r_text">' + v.a_text + '</div>';

        output.innerHTML += str;
    });
    </script>

<br>

<%= link_to 'New User', new_user_path %>
